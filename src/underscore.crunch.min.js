/*
    Underscore crunch
    Extention to underscore for handling callbacks
    (c) 2014 Ashwin Hamal, FoodtoEat
    Underscore Plus may be freely distributed under the MIT license
*/
(function(e,n){"function"==typeof define&&define.amd?define(["underscore"],n):"object"==typeof exports?module.exports=n(require("underscore")):n(e._)})(this,function(e){var n=e.succeed=function(n){n&&e.isFunction(n.success)&&n.success()},t=e.complete=function(n){n&&e.isFunction(n.complete)&&n.complete()};e.finish=function(e){t(e),n(e)};var o=e.crunch=function(n,t){return function(r){var c;if(e.isFunction(n))return n(r);if(e.isArray(n))return e.isEmpty(n)?e.finish(r):(c={success:e.after(n.length,r.success||function(){}),error:e.once(r.error||function(){}),complete:e.after(n.length,r.complete||function(){})},e.map(n,function(e){return o(e,t)(c)}));if(n&&n.pre&&n.post){var i={};return c=e.extend({},r,{complete:e.after(2,r.complete||function(){})}),i.pre=o(n.pre,t).call(void 0,{success:function(){i.post=o(n.post,t).call(void 0,c)},error:function(){c.error.apply(void 0,arguments),t?i.post=o(n.post,t).call(void 0,c):e.complete(c)},complete:function(){e.complete(c)}}),i}throw Error("Invalid structure for _.crunch")}};return e});