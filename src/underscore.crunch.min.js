/*
    Underscore crunch
    Extention to underscore for handling callbacks
    (c) 2014 Ashwin Hamal, FoodtoEat
    Underscore Plus may be freely distributed under the MIT license
*/
(function(e,n){"function"==typeof define&&define.amd?define(["underscore"],n):"object"==typeof exports?module.exports=n(require("underscore")):n(e._)})(this,function(e){var n=e.succeed=function(n){n&&e.isFunction(n.success)&&n.success()},t=e.complete=function(n){n&&e.isFunction(n.complete)&&n.complete()};e.finish=function(e){t(e),n(e)};var c=e.crunch=function(n,t){return function(o){var r;if(e.isFunction(n))return n(o);if(e.isArray(n)&&!e.isEmpty(n))return r={success:e.after(n.length,o.success||function(){}),error:e.once(o.error||function(){}),complete:e.after(n.length,o.complete||function(){})},e.map(n,function(e){return c(e,t)(r)});if(n&&n.pre&&n.post){var u={};return r=e.extend({},o,{complete:e.after(2,o.complete||function(){})}),u.pre=c(n.pre,t).call(void 0,{success:function(){u.post=c(n.post,t).call(void 0,r)},error:function(){r.error.apply(void 0,arguments),t?u.post=c(n.post,t).call(void 0,r):e.complete(r)},complete:function(){e.complete(r)}}),u}throw"Invalid structure for _.crunch"}};return e});