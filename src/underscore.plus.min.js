/*
    Underscore Plus
    Extension tols for underscore
    (c) 2014 Ashwin Hamal, FoodtoEat
    Underscore Plus may be freely distributed under the MIT license
*/
(function(e,n){"function"==typeof define&&define.amd?define(["underscore"],n):"object"==typeof exports?module.exports=n(require("underscore")):n(e._)})(this,function(e){var n=e.crunch=function(c){return function(o){var t={success:e.after(c.length,e.isFunction(o.success)?o.success:function(){}),error:e.once(e.isFunction(o.error)?o.error:function(){}),complete:e.after(c.length,e.isFunction(o.complete)?o.complete:function(){})};e.each(c,function(c){if(e.isFunction(c))c(t);else{if(!e.isArray(c.pre)||!e.isArray(c.post))throw"Invalid structure";t.complete=e.after(2,t.complete),n(c.pre).call(void 0,e.extend({},t,{success:function(){n(c.post).call(void 0,t)},error:function(){t.error.apply(void 0,arguments),t.complete()},complete:function(){t.complete()}}))}})}},c=e.complete=function(n){n&&e.isFunction(n.complete)&&n.complete()},o=e.succeed=function(n){n&&e.isFunction(n.success)&&n.success()};return e.finish=function(e){c(e),o(e)},e});